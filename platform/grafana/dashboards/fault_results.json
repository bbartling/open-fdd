{
  "uid": "fault-results",
  "title": "Fault Results (open-fdd)",
  "schemaVersion": 42,
  "time": { "from": "now-7d", "to": "now" },
  "panels": [
    {
      "type": "stat",
      "title": "Fault count (time range)",
      "gridPos": {"x": 0, "y": 0, "w": 6, "h": 4},
      "datasource": {"type": "postgres", "uid": "openfdd_timescale"},
      "targets": [{
        "format": "table",
        "rawSql": "SELECT COALESCE(SUM(flag_value), 0)::bigint AS value FROM fault_results WHERE $__timeFilter(ts)",
        "refId": "A"
      }],
      "fieldConfig": {
        "defaults": {
          "color": { "mode": "thresholds" },
          "thresholds": {
            "steps": [
              {"value": null, "color": "green"},
              {"value": 1, "color": "yellow"},
              {"value": 10, "color": "red"}
            ]
          },
          "mappings": []
        }
      }
    },
    {
      "type": "text",
      "title": "",
      "gridPos": {"x": 6, "y": 0, "w": 18, "h": 4},
      "options": {
        "content": "**No data in charts?** Usually means no faults detected (system healthy). FDD runs every few hours; widen the time range if needed. Data appears only when rules flag a fault.",
        "mode": "markdown"
      }
    },
    {
      "type": "timeseries",
      "title": "Fault flags by fault_id",
      "gridPos": {"x": 0, "y": 4, "w": 24, "h": 10},
      "datasource": {"type": "postgres", "uid": "openfdd_timescale"},
      "targets": [{
        "format": "time_series",
        "rawSql": "SELECT ts AS time, fault_id AS metric, SUM(flag_value) AS value FROM fault_results WHERE $__timeFilter(ts) GROUP BY ts, fault_id ORDER BY ts",
        "refId": "A"
      }]
    },
    {
      "type": "timeseries",
      "title": "Faults by equipment",
      "gridPos": {"x": 0, "y": 14, "w": 24, "h": 10},
      "datasource": {"type": "postgres", "uid": "openfdd_timescale"},
      "targets": [{
        "format": "time_series",
        "rawSql": "SELECT ts AS time, fault_id AS metric, flag_value AS value FROM fault_results WHERE ('$equipment' = '' OR equipment_id = '$equipment') AND $__timeFilter(ts) ORDER BY ts",
        "refId": "A"
      }]
    }
  ],
  "templating": {
    "list": [{
      "name": "equipment",
      "type": "query",
      "datasource": {"type": "postgres", "uid": "openfdd_timescale"},
      "query": "SELECT equipment_id AS __text, equipment_id AS __value FROM fault_results WHERE equipment_id != '' GROUP BY equipment_id UNION ALL SELECT 'All', '' ORDER BY __value",
      "refresh": 1,
      "includeAll": false,
      "current": {"text": "All", "value": ""}
    }]
  }
}
