# Rule B â€” Blended air temp below expected band (GL36-inspired)
# MAT should be between OAT and RAT; fault if MAT < min(OAT, RAT)
name: mix_temp_too_low
description: Mix temperature too low; should be between outside and return air
type: expression
flag: rule_b_flag
equipment_type: [AHU, VAV_AHU]

inputs:
  Mixed_Air_Temperature_Sensor:
    brick: Mixed_Air_Temperature_Sensor
  Return_Air_Temperature_Sensor:
    brick: Return_Air_Temperature_Sensor
  Outside_Air_Temperature_Sensor:
    brick: Outside_Air_Temperature_Sensor
  Supply_Fan_Speed_Command:
    brick: Supply_Fan_Speed_Command

params:
  mix_err_thres: 1.0
  return_err_thres: 1.0
  outdoor_err_thres: 1.0

expression: |
  (Mixed_Air_Temperature_Sensor - mix_err_thres < np.minimum(Return_Air_Temperature_Sensor - return_err_thres, Outside_Air_Temperature_Sensor - outdoor_err_thres)) & (Supply_Fan_Speed_Command > 0.01)
